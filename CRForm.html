<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #e0f7fa, #e1bee7); padding: 20px; margin: 0; }
    .container { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 6px 12px rgba(0,0,0,0.1); max-width: 500px; margin: auto; text-align: center; }
    h3 { color: #6a1b9a; }
    img { width: 80px; margin-bottom: 10px; }
    label { display: block; text-align: left; margin: 10px 0 4px; font-weight: bold; color: #4a148c; }
    input, select, button { margin: 6px 0; width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; }
    button { background: linear-gradient(to right, #8e24aa, #6a1b9a); color: white; font-weight: bold; cursor: pointer; transition: background 0.3s; }
    button:hover { background: linear-gradient(to right, #6a1b9a, #4a148c); }
  </style>
</head>
<body>
<div class="container">
  <img src="https://img.icons8.com/color/96/000000/task--v1.png" alt="CR Icon">
  <h3>âž• Add New CR</h3>
  <label>CR/Incident:</label><input type="text" id="crIncident">
  <label>Reason:</label><input type="text" id="reason">
  <label>Raised by:</label><select id="raisedBy"></select>
  <label>Assigned to:</label><select id="assignedTo"></select>
  <label>Approver:</label><select id="approver"></select>
  <label>Implementer:</label><select id="implementer"></select>
  <label>Validator:</label><select id="validator"></select>
  <label>Start Date & Time:</label><input type="datetime-local" id="startDateTime">
  <label>End Date & Time:</label><input type="datetime-local" id="endDateTime">
  <button onclick="submitForm()">Submit CR</button>
</div>
<script>
google.script.run.withSuccessHandler(function(data) {
  const members = data.teamMembers;
  ["raisedBy", "assignedTo", "approver", "implementer", "validator"].forEach(id => {
    const select = document.getElementById(id);
    members.forEach(name => { const option = document.createElement("option"); option.value = name; option.text = name; select.add(option); });
  });
}).getDropdownData();
function submitForm() {
  const formData = {
    crIncident: document.getElementById("crIncident").value,
    reason: document.getElementById("reason").value,
    raisedBy: document.getElementById("raisedBy").value,
    assignedTo: document.getElementById("assignedTo").value,
    approver: document.getElementById("approver").value,
    implementer: document.getElementById("implementer").value,
    validator: document.getElementById("validator").value,
    startDateTime: document.getElementById("startDateTime").value,
    endDateTime: document.getElementById("endDateTime").value,
  };
  if (!formData.crIncident || !formData.startDateTime || !formData.endDateTime) { alert("Please fill all mandatory fields."); return; }
  google.script.run.withSuccessHandler(() => { alert("CR added successfully!"); google.script.host.close(); }).addCR(formData);
}
</script>
</body>
</html>